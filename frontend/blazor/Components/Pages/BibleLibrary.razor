@page "/bible-library"
@using PalavraConectada.Blazor.Services
@inject BackendApiService BackendApi
@inject NavigationManager Navigation

<!-- Biblioteca B√≠blica - Menu completo da Palavra de Deus -->
<PageTitle>Biblioteca B√≠blica üìñ</PageTitle>

<div class="bible-library-container">
    <div class="header">
        <h1>üìñ Biblioteca B√≠blica</h1>
        <p class="subtitle">Explore a Palavra de Deus organizada por testamentos e temas</p>
    </div>

    <!-- MENU DE CATEGORIAS -->
    <div class="categories-grid">
        
        <!-- VELHO TESTAMENTO -->
        <div class="category-card" @onclick='() => SelectCategory("vt")'>
            <div class="category-icon">üìú</div>
            <h3>Velho Testamento</h3>
            <p>39 livros da cria√ß√£o at√© os profetas</p>
            <span class="badge-vt">Lei ‚Ä¢ Profetas ‚Ä¢ Escritos</span>
        </div>

        <!-- NOVO TESTAMENTO -->
        <div class="category-card" @onclick='() => SelectCategory("nt")'>
            <div class="category-icon">‚úùÔ∏è</div>
            <h3>Novo Testamento</h3>
            <p>27 livros sobre Jesus e a Igreja</p>
            <span class="badge-nt">Evangelhos ‚Ä¢ Cartas ‚Ä¢ Apocalipse</span>
        </div>

        <!-- RIQUEZA & PROSPERIDADE -->
        <div class="category-card prosperity" @onclick='() => SelectCategory("prosperity")'>
            <div class="category-icon">üí∞</div>
            <h3>Riqueza & Prosperidade</h3>
            <p>B√™n√ß√£os e abund√¢ncia em Deus</p>
            <span class="badge-theme">Tema Especial</span>
        </div>

        <!-- SALVA√á√ÉO EM JESUS -->
        <div class="category-card salvation" @onclick='() => SelectCategory("salvation")'>
            <div class="category-icon">‚ú®</div>
            <h3>Salva√ß√£o em Jesus</h3>
            <p>O plano de Deus para sua vida</p>
            <span class="badge-salvation">Essencial</span>
        </div>

    </div>

    <!-- LOADING -->
    @if (isLoading)
    {
        <div class="loading">
            <div class="spinner"></div>
            <p>Carregando...</p>
        </div>
    }

    <!-- CONTE√öDO DA CATEGORIA SELECIONADA -->
    @if (!string.IsNullOrEmpty(selectedCategory) && !isLoading)
    {
        <div class="category-content">
            
            <!-- VELHO TESTAMENTO -->
            @if (selectedCategory == "vt" && vtBooks != null)
            {
                <div class="testament-section">
                    <div class="section-header">
                        <h2>üìú Velho Testamento</h2>
                        <p>@vtBooks.Count livros encontrados</p>
                    </div>

                    <div class="books-grid">
                        @foreach (var book in vtBooks)
                        {
                            <div class="book-card">
                                <h4>@book.BookName</h4>
                                <p class="book-meta">@book.Author ‚Ä¢ @book.Group</p>
                            </div>
                        }
                    </div>
                </div>
            }

            <!-- NOVO TESTAMENTO -->
            @if (selectedCategory == "nt" && ntBooks != null)
            {
                <div class="testament-section">
                    <div class="section-header">
                        <h2>‚úùÔ∏è Novo Testamento</h2>
                        <p>@ntBooks.Count livros encontrados</p>
                    </div>

                    <div class="books-grid">
                        @foreach (var book in ntBooks)
                        {
                            <div class="book-card">
                                <h4>@book.BookName</h4>
                                <p class="book-meta">@book.Author ‚Ä¢ @book.Group</p>
                            </div>
                        }
                    </div>
                </div>
            }

            <!-- RIQUEZA & PROSPERIDADE -->
            @if (selectedCategory == "prosperity" && prosperityVerses != null)
            {
                <div class="theme-section prosperity">
                    <div class="section-header">
                        <h2>üí∞ Riqueza & Prosperidade</h2>
                        <p>Vers√≠culos sobre b√™n√ß√£os e abund√¢ncia</p>
                    </div>

                    <div class="verses-list">
                        @foreach (var verse in prosperityVerses)
                        {
                            <div class="verse-card-library">
                                <div class="verse-reference">@verse.BookName @verse.Chapter:@verse.Number</div>
                                <div class="verse-text">"@verse.Text"</div>
                                <div class="verse-author">@verse.Author</div>
                            </div>
                        }
                    </div>
                </div>
            }

            <!-- SALVA√á√ÉO EM JESUS -->
            @if (selectedCategory == "salvation" && salvationData != null)
            {
                <div class="theme-section salvation">
                    <div class="section-header">
                        <h2>‚ú® Plano de Salva√ß√£o</h2>
                        <p>@salvationData.Description</p>
                    </div>

                    <!-- PASSOS DA SALVA√á√ÉO -->
                    @if (salvationData.Steps != null)
                    {
                        <div class="salvation-steps">
                            <h3>üìã Os Passos da Salva√ß√£o:</h3>
                            <ol class="steps-list">
                                @foreach (var step in salvationData.Steps)
                                {
                                    <li>@step</li>
                                }
                            </ol>
                        </div>
                    }

                    <!-- VERS√çCULOS -->
                    @if (salvationData.Verses != null)
                    {
                        <div class="verses-list">
                            @foreach (var verse in salvationData.Verses)
                            {
                                <div class="verse-card-library salvation">
                                    <div class="verse-reference">@verse.BookName @verse.Chapter:@verse.Number</div>
                                    <div class="verse-text">"@verse.Text"</div>
                                    <div class="verse-author">@verse.Author</div>
                                </div>
                            }
                        </div>
                    }

                    <!-- CHAMADO -->
                    <div class="salvation-call">
                        <h3>‚úùÔ∏è Aceite Jesus Hoje!</h3>
                        <p>Se voc√™ cr√™ que Jesus morreu por voc√™ e ressuscitou, confesse com sua boca e creia em seu cora√ß√£o. A salva√ß√£o √© um presente de Deus pela gra√ßa!</p>
                        <button class="btn-salvation" @onclick="ShowPrayer">üôè Ora√ß√£o de Salva√ß√£o</button>
                    </div>

                    @if (showPrayer)
                    {
                        <div class="prayer-box">
                            <h4>üôè Ore Comigo:</h4>
                            <p class="prayer-text">
                                "Senhor Jesus, reconhe√ßo que sou pecador e preciso de Ti.
                                Creio que morreste na cruz pelos meus pecados e ressuscitaste ao terceiro dia.
                                Perdoa os meus pecados e vem morar em meu cora√ß√£o.
                                Quero Te seguir como meu Senhor e Salvador.
                                Em nome de Jesus, am√©m!"
                            </p>
                            <p class="congratulations">üéâ Se voc√™ fez esta ora√ß√£o com sinceridade, voc√™ agora √© filho(a) de Deus! Bem-vindo(a) √† fam√≠lia!</p>
                        </div>
                    }
                </div>
            }

        </div>
    }

    <!-- VOLTAR -->
    @if (!string.IsNullOrEmpty(selectedCategory))
    {
        <div class="back-button-container">
            <button class="btn-back" @onclick="ClearSelection">
                ‚Üê Voltar para Categorias
            </button>
        </div>
    }
</div>

@code {
    private string selectedCategory = string.Empty;
    private bool isLoading = false;
    private bool showPrayer = false;

    // Dados
    private List<BookDto>? vtBooks;
    private List<BookDto>? ntBooks;
    private List<VerseDto>? prosperityVerses;
    private SalvationResponse? salvationData;

    private async Task SelectCategory(string category)
    {
        selectedCategory = category;
        isLoading = true;
        showPrayer = false;

        try
        {
            switch (category)
            {
                case "vt":
                    var vtResponse = await BackendApi.GetOldTestamentAsync();
                    vtBooks = vtResponse?.Books ?? new List<BookDto>();
                    break;

                case "nt":
                    var ntResponse = await BackendApi.GetNewTestamentAsync();
                    ntBooks = ntResponse?.Books ?? new List<BookDto>();
                    break;

                case "prosperity":
                    var prosperityResponse = await BackendApi.GetProsperityVersesAsync();
                    prosperityVerses = prosperityResponse?.Verses ?? new List<VerseDto>();
                    break;

                case "salvation":
                    salvationData = await BackendApi.GetSalvationVersesAsync();
                    break;
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Erro ao carregar categoria: {ex.Message}");
        }
        finally
        {
            isLoading = false;
        }
    }

    private void ClearSelection()
    {
        selectedCategory = string.Empty;
        showPrayer = false;
    }

    private void ShowPrayer()
    {
        showPrayer = true;
    }
}

